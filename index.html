<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Premium Business Intelligence Dashboard</title>

  <!-- Tailwind & Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>

  <!-- date-fns UMD -->
  <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/dist/date-fns.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #E2E8F0; }
    .header-font { font-family: 'Poppins', sans-serif; }
    .data-font { font-family: 'Roboto Mono', monospace; }
    .chart-container { position: relative; width: 100%; height: 320px; max-height: 400px; }
    .kpi-card { transition: transform .2s, box-shadow .2s; border-radius: .75rem; background-color: #1E293B; box-shadow: 0 4px 6px rgba(0,0,0,.2), 0 10px 15px rgba(0,0,0,.2); }
    .kpi-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,.3), 0 20px 25px rgba(0,0,0,.3); }
    .control-btn.active, .tab-btn.active { background-color: #3B82F6; color: #fff; }
    .control-btn, .tab-btn { transition: background-color .2s, color .2s; font-weight: 500; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card-bg { background-color: #1E293B; }
    .panel-bg { background-color: #334155; }
  </style>
</head>
<body class="p-4 sm:p-6 lg:p-12">
  <div class="max-w-7xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-bold header-font text-[#F1F5F9]">Business Intelligence Dashboard</h1>
      <p class="text-gray-400 mt-2 text-lg">A premium overview of key metrics.</p>
    </header>

    <section id="data-upload" class="mb-8 p-6 card-bg rounded-xl shadow-lg">
      <h2 class="text-2xl font-semibold header-font text-white mb-2">Data Operations</h2>
      <p class="text-gray-400 text-sm mb-4">Upload a CSV file to refresh the dashboard or manage user data.</p>
      <div class="flex flex-col sm:flex-row items-center gap-4">
        <input type="file" id="data-file-input" accept=".csv" class="w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700"/>
        <button id="load-data-btn" class="w-full sm:w-auto px-6 py-2 text-sm font-semibold rounded-full text-white bg-gray-500 hover:bg-gray-600 transition-colors">Load Data</button>
      </div>
      <div id="upload-status" class="mt-4 text-sm font-medium text-red-400"></div>
    </section>

    <!-- Tabs -->
    <section id="tabs" class="mb-8">
      <div class="flex items-center gap-2 bg-slate-800 p-1 rounded-full shadow-lg">
        <button class="tab-btn active px-6 py-2 text-sm rounded-full" data-target="overview-tab">Overview</button>
        <button class="tab-btn px-6 py-2 text-sm rounded-full" data-target="order-analysis-tab">Order Analysis</button>
        <button class="tab-btn px-6 py-2 text-sm rounded-full" data-target="insights-tab">Insights & Predictions</button>
      </div>
    </section>

    <!-- Overview Tab -->
    <div id="overview-tab" class="tab-content active">
      <section id="controls" class="mb-8 p-6 card-bg rounded-xl shadow-lg flex flex-col sm:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-2 bg-slate-800 p-1 rounded-full">
          <button id="mom-btn" class="control-btn active px-6 py-2 text-sm rounded-full">MoM</button>
          <button id="wow-btn" class="control-btn px-6 py-2 text-sm rounded-full">WoW</button>
          <button id="dod-btn" class="control-btn px-6 py-2 text-sm rounded-full">DoD</button>
        </div>
        <div class="flex items-center gap-2">
          <label for="period-select" class="text-sm font-medium text-gray-400">Select Period:</label>
          <select id="period-select" class="bg-slate-800 border-gray-600 text-gray-300 text-sm rounded-full focus:ring-2 focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5"></select>
        </div>
      </section>

      <!-- KPI Cards -->
      <section id="kpis" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <div class="kpi-card p-8"><h3 class="text-gray-400 text-sm">Total Revenue</h3><p id="kpi-revenue" class="text-4xl font-semibold mt-2 data-font text-white">₹0</p><p id="kpi-revenue-change" class="text-sm mt-1 font-semibold text-green-400">+0% vs last period</p></div>
        <div class="kpi-card p-8"><h3 class="text-gray-400 text-sm">New Customers</h3><p id="kpi-customers" class="text-4xl font-semibold mt-2 data-font text-white">0</p><p id="kpi-customers-change" class="text-sm mt-1 font-semibold text-green-400">+0% vs last period</p></div>
        <div class="kpi-card p-8"><h3 class="text-gray-400 text-sm">Total Orders</h3><p id="kpi-orders" class="text-4xl font-semibold mt-2 data-font text-white">0</p><p id="kpi-orders-change" class="text-sm mt-1 font-semibold text-green-400">+0% vs last period</p></div>
        <div class="kpi-card p-8"><h3 class="text-gray-400 text-sm">Avg. Order Value</h3><p id="kpi-aov" class="text-4xl font-semibold mt-2 data-font text-white">₹0.00</p><p id="kpi-aov-change" class="text-sm mt-1 font-semibold text-red-400">-0% vs last period</p></div>
      </section>

      <!-- Charts -->
      <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="card-bg p-8 rounded-xl shadow-lg"><h2 class="text-2xl font-semibold header-font text-white mb-1">User Retention</h2><p class="text-sm text-gray-400 mb-4">Percentage of new customers who reorder in future periods.</p><div class="chart-container"><canvas id="retentionChart"></canvas></div></div>
        <div class="card-bg p-8 rounded-xl shadow-lg"><h2 class="text-2xl font-semibold header-font text-white mb-1">Avg. Revenue Per User (ARPU)</h2><p class="text-sm text-gray-400 mb-4">Average revenue from each active customer.</p><div class="chart-container"><canvas id="arpuChart"></canvas></div></div>
      </main>
    </div>

    <!-- Other tabs omitted for brevity (same as yours, unchanged) -->

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // (All your JS helpers and chart logic remain unchanged...)

      const main = () => {
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9MKHElNPvzavMfIjy5Bu9qxq2rjGL7ynP1W_7xVmK5S6Of-Ye9h34ZtqDipVP46bsI4TtMHMPwM7F/pub?output=csv";

        fetch(csvUrl)
          .then(response => response.text())
          .then(csvText => {
            allOrders = parseCSV(csvText);
            initCharts();
            setupControls();
            populatePeriodSelector();
            renderAllCharts(allOrders);
          })
          .catch(err => {
            console.error("Error fetching Google Sheet CSV:", err);
            allOrders = generateMockData().map(o => ({ ...o, orderDate: new Date(o.orderDate), acquisitionDate: new Date(o.acquisitionDate) }));
            initCharts();
            setupControls();
            populatePeriodSelector();
            renderAllCharts(allOrders);
          });
      };

      main();
    });
  </script>
</body>
</html>
